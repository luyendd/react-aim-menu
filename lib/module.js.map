{"mappings":";;;;;;;AGAO,SAAS;IACZ,OAAO,MAAM,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,GAAG;AACtD;AAEO,MAAM,4CAAmB,SAAS,UAAsB;IAC3D,IAAI,MAAM;QAAE,GAAG;QAAG,GAAG;IAAE;IACvB,IAAI,WAAW,KAAK,IAAI,WAAW,KAAK,EACpC,MAAM;QAAE,GAAG,WAAW,KAAK;QAAE,GAAG,WAAW,KAAK;IAAC;SAC9C,IAAI,WAAW,OAAO,IAAI,WAAW,OAAO,EAC/C,MAAM;QACF,GAAG,WAAW,OAAO,GAAG,SAAS,IAAI,CAAC,UAAU,GAAG,SAAS,eAAe,CAAC,UAAU;QACtF,GAAG,WAAW,OAAO,GAAG,SAAS,IAAI,CAAC,SAAS,GAAG,SAAS,eAAe,CAAC,SAAS;IACxF;IAEJ,OAAO;AACX;AAEO,MAAM,4CAAe,SAAS,IAAa;IAC9C,MAAM,cAAc,KAAK,qBAAqB;IAC9C,MAAM,aAAa,OAAO,WAAW,IAAI,SAAS,eAAe,CAAC,UAAU;IAC5E,MAAM,YAAY,OAAO,WAAW,IAAI,SAAS,eAAe,CAAC,SAAS;IAC1E,OAAO;QACH,SAAS;YACL,GAAG,YAAY,IAAI,GAAG;YACtB,GAAG,YAAY,GAAG,GAAG;QACzB;QACA,UAAU;YACN,GAAG,YAAY,IAAI,GAAG,aAAa,YAAY,KAAK;YACpD,GAAG,YAAY,GAAG,GAAG;QACzB;QACA,YAAY;YACR,GAAG,YAAY,IAAI,GAAG;YACtB,GAAG,YAAY,GAAG,GAAG,YAAY,YAAY,MAAM;QACvD;QACA,aAAa;YACT,GAAG,YAAY,IAAI,GAAG,aAAa,YAAY,KAAK;YACpD,GAAG,YAAY,GAAG,GAAG,YAAY,YAAY,MAAM;QACvD;IACJ;AACJ;AAEO,MAAM,4CAAkB,SAAS,OAAY,EAAE,KAA+B,EAAE,YAAY,OAAO;IACtG,IAAI,cAAc,SAAS;QACvB,MAAM,SAAS,QAAQ,WAAW,CAAC,CAAC,GAAG,QAAQ,QAAQ,CAAC,CAAC;QACzD,OAAO;YACH,GAAG;gBACC,GAAG,MAAM,CAAC;gBACV,GAAG,MAAM,CAAC;YACd;YACA,GAAG;gBACC,GAAG,QAAQ,QAAQ,CAAC,CAAC;gBACrB,GAAG,KAAK,GAAG,CAAC,GAAG,QAAQ,QAAQ,CAAC,CAAC,GAAG;YACxC;YACA,GAAG;gBACC,GAAG,QAAQ,WAAW,CAAC,CAAC;gBACxB,GAAG,KAAK,GAAG,CAAC,OAAO,WAAW,GAAG,QAAQ,QAAQ,WAAW,CAAC,CAAC,GAAG;YACrE;QACJ;IACJ,OAAO,IAAI,cAAc,QACrB,OAAO;QACH,GAAG;QACH,GAAG,QAAQ,QAAQ;QACnB,GAAG,QAAQ,WAAW;IAC1B;AAER;AAEO,MAAM,4CAAmB,SAAS,QAAQ,EAAE,KAAK;IACpD,MAAM,KAAE,CAAC,KAAE,CAAC,KAAE,CAAC,EAAE,GAAG;IACpB,OAAO,oCAAc,6BAAO,GAAE,IAAI,GAAG,UAC9B,oCAAc,6BAAO,GAAE,IAAI,GAAG,UAC9B,oCAAc,6BAAO,GAAE,IAAI,GAAG;AACzC;AAGA,MAAM,sCAAgB,SAAS,IAAI,EAAE,MAAM,EAAE,MAAM;IAC/C,OAAO,kCAAY,MAAM,YAAY,kCAAY,MAAM;AAC3D;AAEA,MAAM,oCAAc,SAAS,IAAI,EAAE,KAAK;IACpC,MAAM,UAAU,+BAAS,KAAK,EAAE,EAAE,KAAK,EAAE;IACzC,MAAM,UAAU,+BAAS,KAAK,EAAE,EAAE;IAClC,MAAM,SAAS,AAAC,QAAQ,CAAC,GAAG,QAAQ,CAAC,GAAK,QAAQ,CAAC,GAAG,QAAQ,CAAC;IAE/D,OAAO,UAAU,IAAI,IAAI;AAC7B;AAEA,MAAM,+BAAS,SAAS,MAAM,EAAE,MAAM;IAClC,OAAO;QACH,IAAI;YAAE,GAAG,MAAM;QAAC;QAChB,IAAI;YAAE,GAAG,MAAM;QAAC;IACpB;AACJ;AAEA,MAAM,iCAAW,SAAS,MAAM,EAAE,MAAM;IACpC,OAAO;QACH,GAAG,OAAO,CAAC,GAAG,OAAO,CAAC;QACtB,GAAG,OAAO,CAAC,GAAG,OAAO,CAAC;IAC1B;AACJ;;;;AC1FA,SAAS,6BAAO,GAAW,EAAE,KAAwB;IACjD,IAAI,CAAC,KAAK;IACV,IAAI,OAAO,QAAQ,YACf,IAAI;SACD,IAAI,KACP,AAAC,IAAoC,OAAO,GAAG;AAEvD;AAEA;;;;;;CAMC,GACD,SAAS,0CAAW,IAAY,EAAE,IAAY;IAC1C;;;;GAID,GACC,OAAO,CAAA,GAAA,cAAM,EAAE;QACX,IAAI,QAAQ,QAAQ,QAAQ,MACxB,OAAO;QAGX,OAAO,CAAC;YACJ,6BAAO,MAAM;YACb,6BAAO,MAAM;QACjB;IACJ,GAAG;QAAC;QAAM;KAAK;AACnB;;;AFpCA,MAAM,8BAAuF;IACzF,eAAe;QACX,MAAM;QACN,WAAW;IACf;IACA,cAAc,EAAE;AACpB;AAEA,SAAS;IACL,IAAI,4BAAM,aAAa,IAAI,4BAAM,aAAa,CAAC,SAAS,EACpD,aAAa,4BAAM,aAAa,CAAC,SAAS;IAE9C,4BAAM,aAAa,GAAG;AAC1B;AAEA,SAAS,+BAAU,QAAQ;IACvB,IAAI,4BAAM,YAAY,CAAC,MAAM,GAAG,GAAG,OAAO;IAC1C,MAAM,kBAAkB,4BAAM,YAAY,CAAC,4BAAM,YAAY,CAAC,MAAM,GAAG,EAAE;IACzE,MAAM,eAAe,4BAAM,YAAY,CAAC,EAAE;IAC1C,MAAM,UAAU,CAAA,GAAA,yCAAW,EAAE;IAC7B,MAAM,WAAW,CAAA,GAAA,yCAAc,EAAE,SAAS;IAE1C,OAAO,CAAA,GAAA,yCAAe,EAAE,UAAU;AACtC;AAQA,MAAM,qCAA6B,CAAC;AAEpC,MAAM,4CAAsB;AAC5B,MAAM,2CAAqB;AAEpB,MAAM,0DAAc,CAAA,GAAA,oBAAY,EAAE;AAOzC,MAAM,2CAAO,CAAA,GAAA,iBAAS,EAAE,SAAS,KAC7B,cACI,aAAa,2CACb,GAAG,OACK,EACZ,GAAwB;IAExB,MAAM,UAAU,CAAA,GAAA,aAAK,EAAE;IACvB,MAAM,YAAY,CAAA,GAAA,yCAAS,EAAE,KAAK;IAElC,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,eAAO,EAAE;IAEjD,SAAS;QACL,IAAI,CAAC,4BAAM,aAAa,IAAI,iBAAiB,4BAAM,aAAa,CAAC,IAAI,EACjE;QAEJ,gBAAgB,4BAAM,aAAa,CAAC,IAAI;QACxC,4BAAM,YAAY,GAAG,EAAE;QACvB;IACJ;IACA,SAAS,YAAa,IAAY;QAC9B;QACA,4BAAM,aAAa,GAAG;kBAAE;QAAK;QAC7B,IAAI,CAAC,gBAAgB,CAAC,+BAAS,QAAQ,OAAO,GAC1C,OAAO;QAEX,4BAAM,aAAa,CAAC,SAAS,GAAG,WAAW,IAAM,gBAAgB;IACrE;IACA,SAAS;QACL,4BAAM,aAAa,GAAG;YAClB,MAAM;YACN,WAAW,WAAW,IAAM,gBAAgB,aAAa;QAC7D;IACJ;IAEA,SAAS,YAAY,KAAuC;QACxD,MAAM,WAAW,IAAI,MAAM,WAAW,CAAC;QACvC,4BAAM,YAAY,CAAC,IAAI,CAAC,CAAA,GAAA,yCAAe,EAAE,MAAM,WAAW;QAC1D,IAAI,4BAAM,YAAY,CAAC,MAAM,GAAG,0CAC5B,4BAAM,YAAY,CAAC,KAAK;IAEhC;IAEA,SAAS,gBAAiB,KAAuC;QAC7D,MAAM,YAAY,IAAI,MAAM,YAAY,CAAC;QACzC;QACA,gBAAgB;IACpB;IAEA,qBACI,gBAAC,0CAAY,QAAQ;QAAC,OAAO;yBAAE;yBAAa;0BAAa;QAAa;kBAClE,cAAA,gBAAC;YAAK,GAAG,KAAK;YAAE,KAAK;YAAW,cAAc;YAAiB,aAAa;sBACvE,MAAM,QAAQ;;;AAI/B;IAEA,2CAAe;;;;AD/Ff,MAAM,+CAAW,CAAA,GAAA,YAAI,EAAE,UAAU,CAAC,SAAS,SACvC,WAAE,OAAO,WAAE,OAAO,EAAE,GAAG,OAAsB,EAC7C,GAAwB;IAExB,MAAM,CAAC,IAAI,MAAM,GAAG,CAAA,GAAA,eAAO,EAAE;IAC7B,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,eAAO,EAAE;IACzC,MAAM,OAAO,CAAA,GAAA,iBAAS,EAAE,CAAA,GAAA,yCAAU;IAElC,CAAA,GAAA,gBAAQ,EAAE;QACN,MAAM,CAAA,GAAA,yCAAS;IACnB,GAAG,EAAE;IAEL,CAAA,GAAA,gBAAQ,EAAE;QACN,IAAI,KAAK,YAAY,IAAI,KAAK,YAAY,KAAK,MAAM,CAAC,UAAU;YAC5D,YAAY;YACZ,WAAW;QACf;QACA,IAAI,KAAK,YAAY,KAAK,MAAM,UAAU;YACtC,YAAY;YACZ,WAAW;QACf;IACJ,GAAG;QAAC,KAAK,YAAY;KAAC;IAEtB,SAAS,iBAAiB,KAAuC;QAC7D,KAAK,WAAW,CAAC;QACjB,MAAM,YAAY,IAAI,MAAM,YAAY,CAAC;IAC7C;IAEA,SAAS,iBAAiB,KAAuC;QAC7D,KAAK,WAAW;QAChB,MAAM,YAAY,IAAI,MAAM,YAAY,CAAC;IAC7C;IAEA,qBACI,gBAAC;QACI,GAAG,KAAK;QACT,KAAK;QACL,cAAc;QACd,cAAc;kBAEb,MAAM,QAAQ;;AAG3B;IAEA,2CAAe","sources":["src/index.tsx","src/MenuItem.tsx","src/Menu.tsx","src/functions.ts","src/useForkRef.ts"],"sourcesContent":["export { default as MenuItem } from './MenuItem';\nexport { default as Menu } from './Menu';\n","import React, { useContext, useEffect, useState } from 'react';\nimport type { HTMLAttributes, ReactNode, Ref } from 'react';\nimport { MenuContext } from './Menu';\nimport { generateId } from './functions'\n\ntype MenuItemProps = {\n    onHover?: () => any\n    onLeave?: () => any\n    children: ReactNode\n} & HTMLAttributes<HTMLDivElement>\n\nconst MenuItem = React.forwardRef(function MenuItem(\n    { onHover, onLeave, ...props }: MenuItemProps,\n    ref: Ref<HTMLDivElement>\n) {\n    const [id, setId] = useState(null);\n    const [expanded, setExpanded] = useState(false);\n    const menu = useContext(MenuContext);\n\n    useEffect(() => {\n        setId(generateId());\n    }, []);\n\n    useEffect(() => {\n        if (menu.expandedItem && menu.expandedItem === id && !expanded) {\n            setExpanded(true);\n            onHover && onHover();\n        }\n        if (menu.expandedItem !== id && expanded) {\n            setExpanded(false);\n            onLeave && onLeave();\n        }\n    }, [menu.expandedItem])\n\n    function handleMouseEnter(event: React.MouseEvent<HTMLDivElement>): void {\n        menu.onItemEnter(id);\n        props.onMouseEnter && props.onMouseEnter(event)\n    }\n\n    function handleMouseLeave(event: React.MouseEvent<HTMLDivElement>): void {\n        menu.onItemLeave()\n        props.onMouseLeave && props.onMouseLeave(event)\n    }\n\n    return (\n        <div\n            {...props}\n            ref={ref}\n            onMouseEnter={handleMouseEnter}\n            onMouseLeave={handleMouseLeave}\n        >\n            {props.children}\n        </div>\n    );\n})\n\nexport default MenuItem;","import React, { forwardRef, createContext, useRef, useState } from 'react';\nimport type { HTMLAttributes, ReactNode, Ref } from 'react';\nimport { getMousePosition, getRectangle, getTriangleZone, isInsideTriangle } from './functions';\nimport { useForkRef } from './useForkRef'\n\nconst state: { pendingExpand: { item: string|null, timeoutId?: any }, mouseHistory: any[]} = {\n    pendingExpand: {\n        item: null,\n        timeoutId: null\n    },\n    mouseHistory: []\n}\n\nfunction clearPendingExpand (): void {\n    if (state.pendingExpand && state.pendingExpand.timeoutId) {\n        clearTimeout(state.pendingExpand.timeoutId);\n    }\n    state.pendingExpand = null;\n}\n\nfunction checkAim (menuElem): boolean {\n    if (state.mouseHistory.length < 2) return false;\n    const currentPosition = state.mouseHistory[state.mouseHistory.length - 1];\n    const prevPosition = state.mouseHistory[0];\n    const menuBox = getRectangle(menuElem);\n    const triangle = getTriangleZone(menuBox, prevPosition);\n\n    return isInsideTriangle(triangle, currentPosition);\n}\n\ninterface ContextState {\n    onItemEnter?: (item: string) => void;\n    onItemLeave?: () => void;\n    expandedItem?: string;\n}\n\nconst defaultState: ContextState = {}\n\nconst DEFAULT_HOVER_DELAY = 450;\nconst MOUSE_HISTORY_SIZE = 3;\n\nexport const MenuContext = createContext(defaultState);\n\ntype MenuProps = {\n    hoverDelay?: number\n    children: ReactNode\n} & HTMLAttributes<HTMLDivElement>\n\nconst Menu = forwardRef(function Menu(\n    {\n        hoverDelay = DEFAULT_HOVER_DELAY,\n        ...props\n    }: MenuProps,\n    ref: Ref<HTMLDivElement>\n) {\n    const menuRef = useRef(null);\n    const forkedRef = useForkRef(ref, menuRef)\n\n    const [expandedItem, setExpandedItem] = useState(null);\n\n    function updateExpand (): void {\n        if (!state.pendingExpand || expandedItem === state.pendingExpand.item) {\n            return;\n        }\n        setExpandedItem(state.pendingExpand.item);\n        state.mouseHistory = [];\n        clearPendingExpand();\n    }\n    function onItemEnter (item: string): void {\n        clearPendingExpand();\n        state.pendingExpand = { item };\n        if (!expandedItem || !checkAim(menuRef.current)) {\n            return updateExpand();\n        }\n        state.pendingExpand.timeoutId = setTimeout(() => updateExpand(), hoverDelay);\n    }\n    function onItemLeave(): void {\n        state.pendingExpand = {\n            item: null,\n            timeoutId: setTimeout(() => updateExpand(), hoverDelay + 100)\n        };\n    }\n\n    function onMouseMove(event: React.MouseEvent<HTMLDivElement>): void {\n        props.onMouseMove && props.onMouseMove(event);\n        state.mouseHistory.push(getMousePosition(event.nativeEvent));\n        if (state.mouseHistory.length > MOUSE_HISTORY_SIZE) {\n            state.mouseHistory.shift();\n        }\n    }\n\n    function handleMenuLeave (event: React.MouseEvent<HTMLDivElement>): void {\n        props.onMouseLeave && props.onMouseLeave(event);\n        clearPendingExpand();\n        setExpandedItem(null);\n    }\n\n    return (\n        <MenuContext.Provider value={{ onItemEnter, onItemLeave, expandedItem }}>\n            <div {...props} ref={forkedRef} onMouseLeave={handleMenuLeave} onMouseMove={onMouseMove}>\n                {props.children}\n            </div>\n        </MenuContext.Provider>\n    );\n})\n\nexport default Menu;","export function generateId (): string {\n    return '_' + Math.random().toString(36).substr(2, 9);\n}\n\nexport const getMousePosition = function(mouseEvent: MouseEvent): { x: number, y: number } {\n    let pos = { x: 0, y: 0 };\n    if (mouseEvent.pageX || mouseEvent.pageY) {\n        pos = { x: mouseEvent.pageX, y: mouseEvent.pageY }\n    } else if (mouseEvent.clientX || mouseEvent.clientY) {\n        pos = {\n            x: mouseEvent.clientX + document.body.scrollLeft + document.documentElement.scrollLeft,\n            y: mouseEvent.clientY + document.body.scrollTop + document.documentElement.scrollTop\n        }\n    }\n    return pos;\n}\n\nexport const getRectangle = function(elem: Element) {\n    const boundingBox = elem.getBoundingClientRect();\n    const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;\n    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n    return {\n        topLeft: {\n            x: boundingBox.left + scrollLeft,\n            y: boundingBox.top + scrollTop,\n        },\n        topRight: {\n            x: boundingBox.left + scrollLeft + boundingBox.width,\n            y: boundingBox.top + scrollTop\n        },\n        bottomLeft: {\n            x: boundingBox.left + scrollLeft,\n            y: boundingBox.top + scrollTop + boundingBox.height,\n        },\n        bottomRight: {\n            x: boundingBox.left + scrollLeft + boundingBox.width,\n            y: boundingBox.top + scrollTop + boundingBox.height,\n        }\n    }\n}\n\nexport const getTriangleZone = function(menuBox: any, point: { x: number, y: number }, direction = 'right') {\n    if (direction === 'right') {\n        const height = menuBox.bottomRight.y - menuBox.topRight.y;\n        return {\n            A: {\n                x: point.x,\n                y: point.y\n            },\n            B: {\n                x: menuBox.topRight.x,\n                y: Math.min(0, menuBox.topRight.y - height)\n            },\n            C: {\n                x: menuBox.bottomRight.x,\n                y: Math.max(window.innerHeight + height, menuBox.bottomRight.y + height)\n            },\n        }\n    } else if (direction === 'down') {\n        return {\n            A: point,\n            B: menuBox.topRight,\n            C: menuBox.bottomRight\n        }\n    }\n}\n\nexport const isInsideTriangle = function(triangle, point): boolean {\n    const { A, B, C } = triangle;\n    return checkSameSide(toEdge(A,B), C, point)\n        && checkSameSide(toEdge(A,C), B, point)\n        && checkSameSide(toEdge(B,C), A, point)\n}\n\n\nconst checkSameSide = function(edge, point1, point2): boolean {\n    return getPolarity(edge, point1) === getPolarity(edge, point2);\n}\n\nconst getPolarity = function(edge, point) {\n    const vectorA = toVector(edge.v1, edge.v2);\n    const vectorB = toVector(edge.v1, point);\n    const scalar = (vectorA.x * vectorB.y) - (vectorA.y * vectorB.x)\n\n    return scalar >= 0 ? 1 : -1;\n}\n\nconst toEdge = function(pointA, pointB) {\n    return {\n        v1: { ...pointA },\n        v2: { ...pointB },\n    }\n}\n\nconst toVector = function(pointA, pointB) {\n    return {\n        x: pointB.x - pointA.x,\n        y: pointB.y - pointA.y\n    }\n}","import { useMemo, MutableRefObject } from 'react';\n/**\n * Credit to material-ui for this snippet\n */\n\ntype HTMLElementOrNull = HTMLElement | null;\ntype CallbackRef = (node: HTMLElementOrNull) => any;\ntype AnyRef = CallbackRef | MutableRefObject<HTMLElementOrNull>\n\nfunction setRef(ref: AnyRef, value: HTMLElementOrNull): void {\n    if (!ref) return\n    if (typeof ref === 'function') {\n        ref(value);\n    } else if (ref) {\n        (ref as React.MutableRefObject<any>).current = value\n    }\n}\n\n/**\n * useForkRef\n * Joins refs together and returns a combination of the two as a new ref\n *\n * @param refA\n * @param refB\n */\nfunction useForkRef(refA: AnyRef, refB: AnyRef): CallbackRef | null {\n    /**\n   * This will create a new function if the ref props change and are defined.\n   * This means react will call the old forkRef with `null` and the new forkRef\n   * with the ref. Cleanup naturally emerges from this behavior\n   */\n    return useMemo(() => {\n        if (refA == null && refB == null) {\n            return null;\n        }\n\n        return (refValue: HTMLElementOrNull) => {\n            setRef(refA, refValue);\n            setRef(refB, refValue);\n        };\n    }, [refA, refB]);\n}\n\nexport { useForkRef };"],"names":[],"version":3,"file":"module.js.map"}